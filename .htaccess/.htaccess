# ========================================
# 1. 路由与伪静态 (mod_rewrite)
# ========================================
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # 如果访问不带 .html 的路径，且对应的 .html 文件存在，则进行内部跳转
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME}.html -f
    RewriteRule ^([^\.]+)$ $1.html [NC,L]

    # 404 错误处理
    ErrorDocument 404 /404.html
</IfModule>

# ========================================
# 2. 开启 GZIP 压缩 (mod_deflate)
# ========================================
<IfModule mod_deflate.c>
    # 压缩常见文本格式
    AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css
    AddOutputFilterByType DEFLATE text/javascript application/javascript application/x-javascript
    # 增加对 JSON 和 字体、SVG 的支持
    AddOutputFilterByType DEFLATE application/json application/xml application/xhtml+xml
    AddOutputFilterByType DEFLATE image/svg+xml application/vnd.ms-fontobject application/x-font-ttf font/opentype
</IfModule>

# ========================================
# 3. 浏览器缓存 (mod_expires)
# ========================================
<IfModule mod_expires.c>
    ExpiresActive On
    
    # 静态资源缓存 1 年
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"

    # 字体文件缓存 1 年
    ExpiresByType font/ttf "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"

    # CSS 和 JS 缓存 1 个月
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"

    # HTML 建议不设置缓存或极短缓存，确保内容即时更新
    ExpiresByType text/html "access plus 0 seconds"
</IfModule>

# ========================================
# 4. 安全性增强（可选建议）
# ========================================
# 禁止直接显示文件夹目录列表
Options -Indexes

# 保护 .htaccess 文件本身
<Files ".htaccess">
    Require all denied
</Files>
